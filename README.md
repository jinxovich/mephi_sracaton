# Spectrum Optimizer

Система для подбора оптимальной комбинации источников света для воспроизведения эталонного спектра солнечного излучения AM1.5G.

## Описание решения

Проект решает задачу синтеза солнечного спектра из набора дискретных источников света (LED, лазеры и др.). Используется жадный алгоритм оптимизации с методом неотрицательных наименьших квадратов (NNLS) для поиска минимального набора источников, которые в комбинации воспроизводят эталонный спектр с заданной точностью.

Ключевые особенности:
- Нормализация и интерполяция спектров источников
- Ранжирование источников по корреляции с эталоном
- Итеративный поиск с пересчетом коэффициентов на каждом шаге
- Контроль максимальной относительной ошибки (по умолчанию 15%)
- Визуализация результатов и анализ ошибок

## Структура проекта

```
├── main.py                    # Основной скрипт для запуска
├── data_loader.py            # Загрузка данных спектров
├── optimizer.py              # Алгоритм оптимизации спектра
├── visualizer.py             # Визуализация и построение графиков
├── generate.py               # Генерация синтетических спектров источников
├── requirements.txt          # Зависимости проекта
├── data/
│   └── am1_5g_spectrum.csv  # Эталонный спектр AM1.5G (должен быть добавлен)
├── config/
│   └── sources/             # CSV-файлы со спектрами источников
└── output/                  # Результирующие графики
```
## Установка и запуск

### Установка зависимостей

pip install -r requirements.txt

### Подготовка данных

1. Эталонный спектр: Поместите файл с эталонным спектром AM1.5G в папку data/am1_5g_spectrum.csv
   - Формат: CSV с колонками "Wavelength (nm)" и спектральная плотность мощности
   - Диапазон длин волн: 380-1100 нм

2. Генерация источников (опционально):
      python generate.py
   
   Создаст набор синтетических спектров различных типов LED и лазеров в config/sources/

### Запуск оптимизации

python main.py

Параметры в `main.py`:
- max_sources: максимальное количество источников в комбинации (по умолчанию 200)
- tolerance: допустимая максимальная относительная ошибка (по умолчанию 0.15 = 15%)

## Результаты

После выполнения программа выводит:
- Найденную комбинацию источников и их коэффициенты
- Максимальную и среднюю ошибку воспроизведения
- Сохраняет графики в папку output/:
  - spectrum_comparison.png - сравнение эталонного и синтезированного спектров
  - spectrum_error_by_wavelength.png - распределение ошибки по длинам волн

## Алгоритм

1. Нормализация всех входных спектров по максимальному значению
2. Ранжирование источников по корреляции с эталонным спектром
3. Жадный поиск: на каждом шаге добавляется источник, максимально снижающий ошибку
4. Оптимизация коэффициентов методом NNLS для каждой комбинации
5. Остановка при достижении допустимой ошибки или максимального количества источников
